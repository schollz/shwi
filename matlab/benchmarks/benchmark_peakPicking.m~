theForces = [15 22.5 30 40 60];
theLCs = [22.5 45 70];

for method = 1:3
tpsMatrix = zeros(length(theLCs),length(theForces));
fpsMatrix = zeros(length(theLCs),length(theForces));
for theLcI=1:length(theLCs)

for theForceI=1:length(theForces)
  
    total = 0;
    tps = 0;
    fps = 0;
    fns = 0;

for theIterations=1:2
    theForce = theForces(theForceI);
    theLc = theLCs(theLcI);

    params.Force = theForce;
    params.ForceSD = 0;
    params.Lc = theLc;
    params.LcSD = 0;
    params.Persistence = 0.4;
    params.numPeaks = round(400/theLc);
    params.rmsNoise = 10;
    params.nonSpecificForce = 50;
    params.nonSpecificForceSD = 10;
    params.nonSpecificForces = 0;
    params.curveLength = 450;
    params.diffusion = 0.0006;
    [data,Foriginal,rlocs,rpks] = generateCurve(params);
    
if method == 1
    [pks_g,locs_g] = getPeaksSEGM(data(:,1),data(:,2),1);
    pause(0.2)
    klocs = locs_g;
    kpks = pks_g;
    realPeaks = rlocs;
    guessPeaks = locs_g';
    [vecDoneOriginal] = getMatches2(realPeaks,guessPeaks,10);
    truePositives = sum(vecDoneOriginal>0);
    falseNegatives = sum(vecDoneOriginal==0);
    [vecDoneOriginal] = getMatches2(guessPeaks,realPeaks,10);
    falsePositives = sum(vecDoneOriginal==0);
    total = total + length(realPeaks);
    tps = tps + truePositives;
    fps = fps + falsePositives;
    fns = fns + falseNegatives;
elseif method == 2
    [pks_g,locs_g] = getPeaksLC(data(:,1),data(:,2),1);
    pause(0.2)
    klocs = locs_g';
    kpks = pks_g';
    realPeaks = rlocs;
    guessPeaks = locs_g';
    [vecDoneOriginal] = getMatches2(realPeaks,guessPeaks,10);
    truePositives = sum(vecDoneOriginal>0);
    falseNegatives = sum(vecDoneOriginal==0);
    [vecDoneOriginal] = getMatches2(guessPeaks,realPeaks,10);
    falsePositives = sum(vecDoneOriginal==0);
    total = total + length(realPeaks);
    tps = tps + truePositives;
    fps = fps + falsePositives;
    fns = fns + falseNegatives;
else
    minPeakDistance = 10;
    minPeakHeight = 12;
    bestLength = 5;
    [peaks] = getPeaksWFFT(data(:,1),data(:,2),minPeakDistance,minPeakHeight,bestLength);
    wpks = peaks(:,2);
    wlocs = peaks(:,1);
    locs_g = peaks(:,1);
    realPeaks = rlocs;
    guessPeaks = locs_g';
    [vecDoneOriginal] = getMatches2(realPeaks,guessPeaks,10);
    truePositives = sum(vecDoneOriginal>0);
    falseNegatives = sum(vecDoneOriginal==0);
    [vecDoneOriginal] = getMatches2(guessPeaks,realPeaks,10);
    falsePositives = sum(vecDoneOriginal==0);
    total = total + length(realPeaks);
    tps = tps + truePositives;
    fps = fps + falsePositives;
    fns = fns + falseNegatives;
end

end


tpsMatrix(theLcI,theForceI) = 100*tps/total;
fpsMatrix(theLcI,theForceI) = 100*fps/total;

end

end
end

figure(method)
subplot(1,2,1)
imagesc(flipud(tpsMatrix))
set(gca,'YTick', 1:length(theLCs),'YTickLabel',fliplr(theLCs));
set(gca,'XTick', 1:length(theForces),'XTickLabel',theForces);
xlabel('Unfolding force [pN]')
ylabel('Contour length increment [nm]')
caxis([0 100])

subplot(1,2,2)
imagesc(flipud(fpsMatrix))
set(gca,'YTick', 1:length(theLCs),'YTickLabel',fliplr(theLCs));
set(gca,'XTick', 1:length(theForces),'XTickLabel',theForces);
xlabel('Unfolding force [pN]')
ylabel('Contour length increment [nm]')
caxis([0 100])



% 
% subplot(2,1,1)
% plot(data(:,1),data(:,2),rlocs,rpks,'+',wlocs,wpks,'*',klocs,kpks,'o','MarkerSize',12)
% % text(-40,200,sprintf('Persistence:\t%2.1f nm \nUnfold Force:\t%2.0f pN\nDelta Lc: \t%2.0f nm\nRMS Noise: \t%2.0f pN\nDiffusion: %2.4f',P,Fu,Lcbaseline,rmsNoise,Ddt))
% legend('Generated','REAL','WFFT','SEGM','location','NorthEastOutside')
% axis([-50 450 -200 400])
% subplot(2,1,2)
% plot(forceLevel(:,1),forceLevel(:,2),'o-',forceLevel(:,1),forceLevel(:,5),'o-',forceLevel(:,1),forceLevel(:,3),'o-',forceLevel(:,1),forceLevel(:,6),'o-',forceLevel(:,1),forceLevel(:,4),'o-',forceLevel(:,1),forceLevel(:,7),'o-')
% legend('LC TPR','LC FPR','WFFT TPR','WFFT FPR','SEGM TPR','SEGM FPR','location','NorthEastOutside')
% axis([min(theForces) max(theForces) -5 105])
